language: csharp
dist: trusty
sudo: false
solution: FluentMigrator.sln
mono: latest
dotnet: 2.1.103
git:
  depth: false
env:
  global:
    secure: LBwjIieB3lGAb21LFO75eW42F3gm4Af+Wd/y37gbAJC9WXLO6i4aLOIDjaheq9wZEWAjsjLrG9aDf2YgCoiboGLhIVVS2CUEcLL8v9A8fdwG0MMdNbJ+HiwOCro97lZywT32yQ6dDzTf2xcUWufQ2YhQXBE52Ym6hMjkm5iaWnY=
before_script:
  - nuget install GitVersion.CommandLine -Version 4.0.0-beta0012 -Prerelease
  - export VERSION_SUFFIX=$(mono GitVersion.CommandLine.4.0.0-beta0012/tools/GitVersion.exe /showvariable NuGetVersion | sed -r 's/^[^-]+-(.*)$/\1/')
  - echo Using VersionSuffix=$VERSION_SUFFIX
script:
  - rm -f "$TRAVIS_BUILD_DIR/output"/*
  - dotnet restore ./FluentMigrator.sln
  - msbuild ./FluentMigrator.sln /v:m /p:VersionSuffix="$VERSION_SUFFIX"
  - dotnet vstest test/FluentMigrator.Tests/bin/Debug/net461/FluentMigrator.Tests.dll --TestCaseFilter:'TestCategory!=NotWorkingOnMono&(TestCategory!=Integration|(TestCategory=Integration&(TestCategory=SQLite)))'
after_success:
  - msbuild ./FluentMigrator.sln /v:m /p:VersionSuffix="$VERSION_SUFFIX" /t:Pack /p:PackageOutputPath="$TRAVIS_BUILD_DIR/output"
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then for pkg in output/* ; do [ -e "$pkg" ] || continue; nuget push "$pkg" "$MYGET_API_KEY" -Source "https://www.myget.org/F/fluent-migrator/api/v2/package" ; done; fi
